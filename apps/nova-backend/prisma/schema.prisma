generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model model {
  id        Int     @id @default(autoincrement())
  name      String  @db.VarChar(255)
  sourceId  Int
  source    source  @relation(fields: [sourceId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model source {
  id     Int     @id @default(autoincrement())
  name   String  @db.VarChar(255)

  models model[]
  key    key?    // максимум один ключ на source
}

model key {
  id         Int      @id @default(autoincrement())

  sourceId   Int      @unique      // <= гарантирует 1‑к‑1: один ключ на источник
  apiKey     String   @db.VarChar(512) @unique

  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  source     source   @relation(fields: [sourceId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sourceId])
}
